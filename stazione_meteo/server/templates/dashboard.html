<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>proj-sistemi | Dashboard</title>

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <!-- Plotly CDN -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js" defer></script>

  <!-- JS -->
  <script src="{{ url_for('static', filename='js/scripts.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
</head>
<body>

  <!-- ===== HEADER + NAVBAR ===== -->
  <header>
    <h1>Dashboard meteo</h1>
    <nav style="margin-top:1rem;">
      <a href="{{ url_for('home') }}" style="margin-right:1.5rem; color:#38bdf8;">Home</a>
      <a href="{{ url_for('dashboard') }}" style="margin-right:1.5rem; color:#38bdf8;">Dashboard</a>
      <a href="{{ url_for('risk') }}" style="color:#38bdf8;">Rischio</a>
    </nav>

    <!-- ===== SEARCH BAR ===== -->
<div style="margin-top:1rem; text-align:center;">
    <input type="text" id="searchInput" placeholder="Cerca pagina..." class="search-bar">
    <button onclick="searchPage()" class="search-btn">Vai</button>
</div>

<style>
/* Stile elegante per la searchbar */
.search-bar {
    padding: 0.6rem 1rem;
    width: 250px;
    border-radius: 25px;
    border: 1px solid #38bdf8;
    outline: none;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.search-bar:focus {
    border-color: #0ea5e9;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.search-btn {
    padding: 0.6rem 1.2rem;
    margin-left: 0.5rem;
    border-radius: 25px;
    background: #38bdf8;
    color: white;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

.search-btn:hover {
    background: #0ea5e9;
}
</style>

<script>
function searchPage() {
    const query = document.getElementById("searchInput").value.toLowerCase().trim();
    const pages = {
        "home": "{{ url_for('home') }}",
        "dashboard": "{{ url_for('dashboard') }}",
        "rischio": "{{ url_for('risk') }}"
            };
    if(pages[query]) {
        window.location.href = pages[query];
    } else {
        alert("Pagina non trovata!");
    }
}
</script>

  </header>

  <main class="container">

    <!-- ===== DATI IN TEMPO REALE ===== -->
    <div class="grid">
      <div class="card">
        <h2>Temperatura</h2>
        <div class="value" id="tempValue">-- °C</div>
        <div class="label">Ultima misura</div>
      </div>
      <div class="card">
        <h2>Umidità</h2>
        <div class="value" id="humValue">-- %</div>
        <div class="label">Ultima misura</div>
      </div>
      <div class="card">
        <h2>Pressione</h2>
        <div class="value" id="pressValue">-- hPa</div>
        <div class="label">Ultima misura</div>
      </div>
    </div>

    <!-- ===== AGGIUNTA: STATO PIOGGIA (SENSORE) ===== -->
    <div class="card" style="margin-top:2rem; text-align:center;">
      <h2>Stato pioggia</h2>
      <div class="value">
        Pioggia: <strong>{{ pioggia_presente }}</strong>
      </div>
      <div class="label">Dato istantaneo dal sensore locale</div>
    </div>
    <!-- ===== FINE AGGIUNTA ===== -->

    <!-- ===== Dati pluviometrici ===== -->
    <div class="card" style="margin-top:2rem;">
      <h2>Dati pluviometrici</h2>
      <div class="value" id="rainValue">-- mm</div>
      <div style="margin-top:0.8rem;">
  <label for="rainInterval" style="font-size:0.9rem; color:#94a3b8;">
    Intervallo di accumulo:
  </label>
  <select id="rainInterval" style="margin-left:0.5rem; padding:0.2rem;">
    <option value="3">Ultime 3 ore</option>
    <option value="6">Ultime 6 ore</option>
    <option value="12">Ultime 12 ore</option>
    <option value="24">Ultime 24 ore</option>
    <option value="48">Ultime 48 ore</option>
  </select>
</div>

      <div class="label">Totale precipitazioni giornaliere</div>
    </div>

    <!-- ===== GRAFICI GIORNALIERI ===== -->
    <div class="card" style="margin-top:2rem;">
      <h2>Grafici giornalieri</h2>
      <div id="tempGraph" style="height:300px;"></div>
      <div id="humGraph" style="height:300px; margin-top:1rem;"></div>
      <div id="pressGraph" style="height:300px; margin-top:1rem;"></div>
    </div>

    <!-- ===== AGGIUNTA: RADAR METEO ===== -->
    <div class="card" style="margin-top:2rem;">
      <h2>Radar meteo in tempo reale</h2>
      <iframe
        src="https://www.rainviewer.com/map.html?loc=41.5/12.2/6&oFa=0&oC=1&oU=0&oCS=1&oF=0&oAP=0&c=1&o=83&lm=1"
        width="100%"
        height="450"
        frameborder="0"
        style="border-radius:12px;">
      </iframe>
      <div class="label">Radar precipitazioni – fonte RainViewer</div>
    </div>
    <!-- ===== FINE AGGIUNTA ===== -->

  </main>

<p id="meteoUpdateTime"
   style="margin-top:1.5rem; font-size:0.85rem; color:#94a3b8; text-align:center;">
  Dati meteo (pressione e pioggia) in aggiornamento…
</p>


  <footer class="site-footer" style="margin-top:2rem; text-align:center; padding:1rem; background:#1e293b; color:white;">
    Progetto sistemi di misura ed elaborazione dati · Stazione Meteo &copy; 2026
  </footer>

</body>
</html>
